"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const koishi_utils_1 = require("koishi-utils");
const child_process_1 = require("child_process");
function apply(ctx) {
    ctx.command('exec <expression...>', '执行命令行', { authority: 4 })
        .shortcut('$', { fuzzy: true, oneArg: true })
        .action(async ({ meta }, expression) => {
        if (!expression)
            return;
        expression = koishi_utils_1.CQCode.unescape(expression);
        return new Promise((resolve) => {
            const child = child_process_1.exec(expression, { cwd: process.cwd() });
            child.stdout.on('data', data => meta.$send(String(data).trim()));
            child.stderr.on('data', data => meta.$send(String(data).trim()));
            child.on('close', resolve);
        });
    });
}
exports.default = apply;
